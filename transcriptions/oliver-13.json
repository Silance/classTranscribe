[{"start":"0:00","end":"0:01","text":"welcome"},{"start":"0:01","end":"0:04","text":"we have a little function so far called currenttime()"},{"start":"0:04","end":"0:08","text":"that requests 128 bytes from the heap"},{"start":"0:08","end":"0:14","text":"and then providing we get a non-null pointer back from malloc"},{"start":"0:14","end":"0:17","text":"we will copy in the time 2:51 PM to that memory"},{"start":"0:17","end":"0:21","text":"and return a pointer to the first byte of that memory"},{"start":"0:21","end":"0:28","text":"we've been careful to check if malloc fails, perhaps our program has used all of the heap memory"},{"start":"0:28","end":"0:30","text":"then we don't try to use that null pointer"},{"start":"0:30","end":"0:39","text":"but now let's make it so that it actually makes a call to find out what the current time is"},{"start":"0:39","end":"0:42","text":"the current time is known by the system"},{"start":"0:42","end":"0:51","text":"time to make a system call and then we will format that using a c function called ctime()"},{"start":"0:51","end":"0:56","text":"to actually give us a human readalbe version of the time"},{"start":"0:56","end":"1:00","text":"both of these functions can be found inside the #include <time.h>"},{"start":"1:00","end":"1:03","text":"I've commented them up here"},{"start":"1:03","end":"1:13","text":"when you call time you can pass it a pointer to a time_t variable"},{"start":"1:13","end":"1:23","text":"or you can pass it NULL and it will still give you back the time in its result"},{"start":"1:23","end":"1:24","text":"let's just use the result"},{"start":"1:24","end":"1:31","text":"here's the number of seconds since 1970"},{"start":"1:31","end":"1:36","text":"we'll store that inside our variable called secondsSince1970"},{"start":"1:36","end":"1:42","text":"but I don't want that as a value, I just want to turn that into a string"},{"start":"1:42","end":"1:52","text":"for that there's a function called ctime, this a library function. there are other functions that give greater control to the precise formatting"},{"start":"1:52","end":"1:59","text":"but for this demo let's just use ctime() which has some reasonable formatting that most people can understand"},{"start":"1:59","end":"2:11","text":"this will give us back a pointer to the time"},{"start":"2:11","end":"2:13","text":"in ASCII, in otherwords in letters, in readable time"},{"start":"2:13","end":"2:21","text":"we can copy that result into new memory, into our result"},{"start":"2:21","end":"2:29","text":"one problem with ctime() is that it uses static storage"},{"start":"2:29","end":"2:37","text":"it's great if you just want to call it once, and it will use it's static storage to give you back the time in a readable format"},{"start":"2:37","end":"2:46","text":"but don't expect that to stay around because if you call ctime() again in the future it is going to overwrite those bytes"},{"start":"2:46","end":"2:48","text":"and that's why our function currenttime() is useful"},{"start":"2:48","end":"2:54","text":"we are going to take the temporary result and put it into some memory that is ours to control"},{"start":"2:54","end":"2:57","text":"so it can't be overwritten"},{"start":"2:57","end":"2:59","text":"we need to pass in secondsSince1970"},{"start":"2:59","end":"3:03","text":"except we've got a problem here"},{"start":"3:03","end":"3:12","text":"it doesn't want the value, it wants a pointer, to know where in memory this variable is"},{"start":"3:12","end":"3:17","text":"for that I have to introduce some new syntax, which is &"},{"start":"3:17","end":"3:26","text":"when you see & it means that I don't want to know about the variable itself, but where it is stored in memory"},{"start":"3:26","end":"3:30","text":"tell me the address of the variable"},{"start":"3:30","end":"3:34","text":"we didn't need this for arrays because that's what the array name gives us automatically"},{"start":"3:34","end":"3:41","text":"but for other items we can use the & to find out where it is stored in memory"},{"start":"3:41","end":"3:45","text":"let's compile and run it"},{"start":"3:45","end":"3:53","text":"we find out that my little virtual machine thinks it's Jan 1 2014"},{"start":"3:53","end":"3:59","text":"not very accurate, but it did print out what it thinks the current time is"},{"start":"3:59","end":"4:06","text":"I promised you that I'd mention a few more mistakes that we can make with heap memory"},{"start":"4:06","end":"4:14","text":"one mistake we can make is to double free the same pointer"},{"start":"4:14","end":"4:28","text":"this can lead to all sorts of horrendous problems because when you tell the heap that you've freed with some memory it might actually use that memory for it's own book keeping"},{"start":"4:28","end":"4:30","text":"so it knows that the particular block of memory is free"},{"start":"4:30","end":"4:39","text":"if you free it again it can confuse the book keeping, the pointers that the heap is using itself"},{"start":"4:39","end":"4:46","text":"once we've freed some memory, dont free it by accident a second time!"},{"start":"4:46","end":"4:53","text":"another common mistake in C programs is to continue using memory after we've freed it"},{"start":"4:53","end":"4:57","text":"we shouldn't consider that memory to be valid anymore"},{"start":"4:57","end":"5:02","text":"perhaps it's going to be reused by some other part of the program that is about to call malloc()"},{"start":"5:02","end":"5:09","text":"and certainly we should expect anything that we've previously stored in there to be valid"},{"start":"5:09","end":"5:13","text":"once we've freed it don't try to use the pointer again"},{"start":"5:13","end":"5:16","text":"for example, this would be an eror"},{"start":"5:16","end":"5:19","text":"how can we guard against some of these errors?"},{"start":"5:19","end":"5:26","text":"one common defensive programming technique is to set a pointer to NULL after freeing it"},{"start":"5:26","end":"5:31","text":"to mean that I'm not pointing to anything anymore"},{"start":"5:31","end":"5:37","text":"this avoids the problem of what is called a dangling pointer error"},{"start":"5:37","end":"5:45","text":"now our pointer is no longer pointing to invalid memory"},{"start":"5:45","end":"5:49","text":"bye!"}]